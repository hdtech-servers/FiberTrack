{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
  <div class="container mt-5">
    <h2 class="mb-4" style="color: darkblue;">Organization Settings</h2>

    <form method="post" enctype="multipart/form-data" class="p-4 shadow-lg rounded" style="background-color: #f9f9f9; border: 2px solid darkblue;">
      {% csrf_token %}

      <!-- Organization Info Section -->
      <div class="mb-4">
        <h4 class="text-dark" style="color: darkblue;">Organization Information</h4>
        <div class="row">
          <!-- Display the current logo -->
          <div class="col-md-4">
            <h5 class="text-muted">Current Logo</h5>
            {% if organization.logo %}
              <img src="{{ organization.logo.url }}" alt="{{ organization.name }}" class="img-fluid img-thumbnail mb-3" style="border: 2px solid darkred;">
            {% else %}
              <p class="text-muted">No logo uploaded.</p>
            {% endif %}
          </div>
          <div class="col-md-6">
            {{ form.name|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.logo|as_crispy_field }} <!-- File input for logo upload -->
          </div>
          <div class="col-md-12">
            {{ form.address|as_crispy_field }}
          </div>
        </div>
      </div>

      <!-- Mpesa API Section -->
      <div class="mb-4">
        <h4 class="text-dark" style="color: darkblue;">Mpesa API Settings</h4>
        <div class="row">
          <div class="col-md-6">
            {{ form.mpesa_consumer_key|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.mpesa_consumer_secret|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.mpesa_short_code|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.mpesa_initiator_username|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.mpesa_security_credential|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.mpesa_passkey|as_crispy_field }}
          </div>
          <div class="col-md-12">
            {{ form.mpesa_callback_url|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.mpesa_environment|as_crispy_field }} <!-- Mpesa environment field -->
          </div>
        </div>
      </div>

      <!-- SMTP Email Section -->
      <div class="mb-4">
        <h4 class="text-dark" style="color: darkblue;">SMTP Email Settings</h4>
        <div class="row">
          <div class="col-md-6">
            {{ form.smtp_host|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.smtp_port|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.smtp_username|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.smtp_password|as_crispy_field }}
          </div>
          <div class="col-md-6">
            {{ form.smtp_from_email|as_crispy_field }}
          </div>
          <div class="col-md-6 form-check form-switch">
            {{ form.smtp_use_tls|as_crispy_field }}
            <label for="id_smtp_use_tls" class="form-check-label">Use TLS</label>
          </div>
          <div class="col-md-6 form-check form-switch">
            {{ form.smtp_use_ssl|as_crispy_field }}
            <label for="id_smtp_use_ssl" class="form-check-label">Use SSL</label>
          </div>
        </div>
      </div>

      <!-- Google Maps API Section -->
      <div class="mb-4">
        <h4 class="text-dark" style="color: darkblue;">Google Maps API</h4>
        <div class="row">
          <div class="col-md-12">
            {{ form.google_maps_api_key|as_crispy_field }} <!-- Google Maps API key field -->
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="mt-4 text-end">
        <button type="submit" class="btn btn-primary btn-icon d-flex align-items-center" style="background-color: darkblue; border-color: darkred;">
          <i class="bi bi-save me-2"></i> Save Settings
        </button>
      </div>
    </form>
  </div>
{% endblock %}
